---
image: python:latest

# enum(.pre, build, test, deploy, .post)
stages:
  - setup
  - test

ansible:setup:
  stage: setup
  script:
    - pip install --root-user-action=ignore ansible
    - pip install --root-user-action=ignore ansible-dev-tools
    - pip show ansible
  after_script:
    - echo "$PATH"
    - echo "$PWD"
    - ansible-lint --version
    - which ansible

ansible:collection-install:
  stage: setup
  needs: ["ansible:setup"]
  before_script:
    - echo $PATH
    - ls /usr/local/bin/ansible*
  script:
    - ansible-galaxy collection install community.general
    - ansible-galaxy collection install ansible.posix

lint-code:
  stage: test
  needs: ["ansible:setup", "ansible:collection-install"]
  script:
    - ansible-lint archall.yml
    
